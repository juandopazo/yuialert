{"ts":1341541375495,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"var env = process.env,\n    port = env.PORT || 80,\n    ip = env.PORT ? '0.0.0.0' : '127.0.0.1',\n    http = require('http'),\n    https = require('https'),\n    gzip = require('zlib'),\n    MINUTES = +env.MINUTES,\n    Twitter = require('ntwitter');\n\nvar twitter = new Twitter({\n    consumer_key: env.TWITTER_CONSUMER_KEY,\n    consumer_secret: env.TWITTER_CONSUMER_SECRET,\n    access_token_key: env.TWITTER_TOKEN_KEY,\n    access_token_secret: env.TWITTER_TOKEN_SECRET\n});\n\nfunction lastUTCMinusMinutes(mins) {\n    var now = new Date();\n    now = new Date(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate(),  now.getUTCHours(), now.getUTCMinutes(), now.getUTCSeconds());\n    now.setMinutes(now.getMinutes() - mins);\n    return now.getTime();\n}\n\nfunction getSOUrl() {\n    var time = lastUTCMinusMinutes(MINUTES),\n        url = '/2.0/questions?fromdate=';\n        url += Math.floor(time / 1000);\n        url += '&order=desc&sort=creation&tagged=yui&site=stackoverflow';\n        url += '&key=' + env.SO_KEY;\n    return url;\n}\n\nfunction sendToTwitter(questions) {\n    questions.forEach(function (question) {\n        var title = question.title;\n        if (title.length > 110) {\n            title = title.substr(0, 107) + '...';\n        }\n        twitter.updateStatus(title + ' http://stackoverflow.com/questions/' + question.question_id + ' #yui', function (err) {\n            if (err) {\n                console.error(err);\n            }\n        });\n    });\n}\n\nsetInterval(function () {\n    console.log('Checking Stack Overflow...');\n    var apiPath = getSOUrl();\n    console.log('Reading SO API: http://api.stackexchange.com' + apiPath);\n    https.get({\n        host: 'api.stackexchange.com',\n        path: apiPath\n    }, function (so) {\n\t\tvar result = '';\n\t\tso.pipe(gzip.createGunzip()).on('data', function (chunk) {\n\t\t\tresult += chunk;\n\t\t}).on('end', function () {\n\t\t\tresult = JSON.parse(result);\n            if (result.error_id) {\n                console.error(result);\n            } else {\n                sendToTwitter(result.items);\n            }\n\t\t});\n\t}).on('error', function (err) {\n        console.error(err);\n    });\n}, 1000 * 60 * MINUTES);\n\nhttp.createServer(function (req, res) {\n    if (req.url == '/favicon.ico') {\n\t\tres.writeHead(200, { 'Content-Type': 'image/png' });\n\t\tres.end();\n    } else {\n\t\tres.writeHead(200, { 'Content-Type': 'text/plain' });\n        res.end('YUI Alert, a Twitter bot that tweets questions asked about YUI in Stack Overflow\\n');\n    }\n}).listen(port, ip);\nconsole.log('Server running at http://' + ip + ':' + port + '/');"]],"start1":0,"start2":0,"length1":0,"length2":2560}]],"length":2560}
{"contributors":[],"silentsave":false,"ts":1341541423161,"patch":[[{"diffs":[[0,"1',\n"],[-1,"    http = require('http'),\n"],[0,"    "]],"start1":91,"start2":91,"length1":36,"length2":8},{"diffs":[[0,"\n}\n\n"],[-1,"setInterval(function () {\n    "],[0,"cons"]],"start1":1425,"start2":1425,"length1":38,"length2":8},{"diffs":[[0,"w...');\n"],[-1,"    "],[0,"var apiP"]],"start1":1464,"start2":1464,"length1":20,"length2":16},{"diffs":[[0,"OUrl();\n"],[-1,"    "],[0,"console."]],"start1":1490,"start2":1490,"length1":20,"length2":16},{"diffs":[[0,"iPath);\n"],[-1,"    "],[0,"https.ge"]],"start1":1561,"start2":1561,"length1":20,"length2":16},{"diffs":[[0,"s.get({\n"],[-1,"    "],[0,"    host"]],"start1":1573,"start2":1573,"length1":20,"length2":16},{"diffs":[[0,"e.com',\n"],[-1,"    "],[0,"    path"]],"start1":1608,"start2":1608,"length1":20,"length2":16},{"diffs":[[0,"apiPath\n"],[-1,"    "],[0,"}, funct"]],"start1":1626,"start2":1626,"length1":20,"length2":16},{"diffs":[[0," (so) {\n"],[-1,"\t"],[0,"\tvar res"]],"start1":1645,"start2":1645,"length1":17,"length2":16},{"diffs":[[0,"t = '';\n"],[-1,"\t"],[0,"\tso.pipe"]],"start1":1663,"start2":1663,"length1":17,"length2":16},{"diffs":[[0,"(chunk) {\n\t\t"],[-1,"\t"],[0,"result += ch"]],"start1":1721,"start2":1721,"length1":25,"length2":24},{"diffs":[[0," chunk;\n"],[-1,"\t"],[0,"\t}).on('"]],"start1":1742,"start2":1742,"length1":17,"length2":16},{"diffs":[[0," () {\n\t\t"],[-1,"\t"],[0,"result ="]],"start1":1772,"start2":1772,"length1":17,"length2":16},{"diffs":[[0,"t);\n        "],[-1,"    "],[0,"if (result.e"]],"start1":1805,"start2":1805,"length1":28,"length2":24},{"diffs":[[0,") {\n            "],[-1,"   "],[-1," "],[0,"console.error(re"]],"start1":1836,"start2":1836,"length1":36,"length2":32},{"diffs":[[0,"        "],[-1,"    "],[0,"} else {"]],"start1":1875,"start2":1875,"length1":20,"length2":16},{"diffs":[[0," else {\n"],[-1,"    "],[0,"        "]],"start1":1884,"start2":1884,"length1":20,"length2":16},{"diffs":[[0,"    "],[-1,"    "],[0,"}\n"],[-1,"\t"],[0,"\t});\n"],[-1,"\t"],[0,"}).o"]],"start1":1937,"start2":1937,"length1":21,"length2":15},{"diffs":[[0,"(err) {\n    "],[-1,"  "],[-1,"  "],[0,"console.erro"]],"start1":1972,"start2":1972,"length1":28,"length2":24},{"diffs":[[0,"r);\n"],[-1,"    });\n}, 1000 * 60 * MINUTES);\n\nhttp.createServer(function (req, res) {\n    if (req.url == '/favicon.ico') {\n\t\tres.writeHead(200, { 'Content-Type': 'image/png' });\n\t\tres.end();\n    } else {\n\t\tres.writeHead(200, { 'Content-Type': 'text/plain' });\n        res.end('YUI Alert, a Twitter bot that tweets questions asked about YUI in Stack Overflow\\n');\n    }\n}).listen(port, ip);\nconsole.log('Server running at http://' + ip + ':' + port + '/');"],[1,"});\n"]],"start1":2000,"start2":2000,"length1":447,"length2":8}]],"length":2008,"saved":false}
{"ts":1341541438318,"patch":[[{"diffs":[[0,"or(err);\n});"],[-1,"\n"]],"start1":1995,"start2":1995,"length1":13,"length2":12}]],"length":2007,"saved":false}
{"ts":1341541534341,"patch":[[{"diffs":[[0,"S = "],[-1,"+env.MINUTES"],[1,"10"],[0,",\n  "]],"start1":163,"start2":163,"length1":20,"length2":10}]],"length":1997,"saved":false}
{"ts":1341541554411,"patch":[[{"diffs":[[0,"nv,\n"],[-1,"    port = env.PORT || 80,\n    ip = env.PORT ? '0.0.0.0' : '127.0.0.1',\n"],[0,"    "]],"start1":19,"start2":19,"length1":80,"length2":8}]],"length":1925,"saved":false}
